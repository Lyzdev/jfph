$(function(){
    // 账号渲染
var userid=localStorage.getItem("id");
if(userid){
    var user=localStorage.getItem("username");
    $(".fwb").html(user);
}


 //初始化插件
 $("#form").validate({
    //规则
    rules: {
        //用户名
        username: {
            required: true,
            isUser: true
        },
        //邮箱
        email: {
            required: true,
            isEmail: true
        },
        //昵称
        nickname: {
            required: true,
            isNickname: true
        },
    },
    //规则的错误提示信息
    messages: {
        //用户名
        username: {
            required: "电话留下!",
        },
        email: {
            required: "邮箱也行",
        },
        nickname: {
            required: "名字也行",
        },
    }
})

  //用户名自定义验证   
  jQuery.validator.addMethod("isUser", function (value, element) {
    var tel = /^1[34578]\d{9}$/;
    rflag = this.optional(element) || (tel.test(value));
    addStateStyle("#phone", rflag);
    return this.optional(element) || (tel.test(value));
}, "电话号码错误！");
 // 邮箱验证
 jQuery.validator.addMethod("isEmail", function (value, element) {
    var tel = /^([A-Za-z0-9_\-\.])+\@([A-Za-z0-9_\-\.])+\.([A-Za-z]{2,4})$/;
    rflag = this.optional(element) || (tel.test(value));
    addStateStyle("#email", rflag);
    return this.optional(element) || (tel.test(value));
}, "邮箱错啦!");
 // 昵称验证
 jQuery.validator.addMethod("isNickname", function (value, element) {
    var tel = /^[a-zA-Z]{1}[0-9a-zA-Z_]{1,}$/;
    rflag = this.optional(element) || (tel.test(value));
    addStateStyle("#nickname", rflag);
    return this.optional(element) || (tel.test(value));
}, "昵称太low!");

    // 验证成功添加状态样式
    function addStateStyle(obj, flag) {
        if (flag) {
            $(obj).css("borderColor", "green");
        } else {
            $(obj).css("borderColor", "red");
        }
    }
    // 输入时去除状态样式
    function removeStateStyle(obj) {
        $(obj).css("borderColor", "#ccc");

    }

    $("#phone").on("focusin", function () {
        removeStateStyle("#phone")
    })
    $("#email").on("focusin", function () {
        removeStateStyle("#email")
    })
    $("#nickname").on("focusin", function () {
        removeStateStyle("#nickname")
    })


    // 账户修改提交
        $("#sub-btn").on("click",function(){
            $.ajax({
                type: "get",
                url: "http://172.16.16.127:8282/updateuser.php",
                data: {
                    id:localStorage.getItem("id"),
                    nickname:$("#nickname").val(),
                    email:$("#email").val(),
                    phone:$("#phone").val(),

                    
                },
                // dataType: "dataType",
                success: function (response) {
                    if(response=="ok"){
                        alert("修改成功！")
                        location.href="#usercenter/myaccount";
                        $("#myaccount").trigger("click");
                    }else{
                        alert("修改失败！")
                    }

                    
                }
            });
        })
        $("#can-btn").on("click",function(){
            $(".person-info").find("input[type=text]").val('');
            removeStateStyle("#phone");
            emoveStateStyle("#email");
            removeStateStyle("#nickname");
        })



















})